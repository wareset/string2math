/* eslint-disable */
var t=Array.prototype.concat;function r(){return t.apply([],arguments)}function e(t){return t[t.length-1]}function a(t){return"function"==typeof t}var n=Object.hasOwn||function(t,r){return Object.prototype.hasOwnProperty.call(t,r)};function s(t){return t?t.toArray():["NaN"]}function i(t,r){return t?t.calculate(r):NaN}class ProgramNode{constructor(t){this.type="Program",this.data=t}toArray(){return s(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return i(this.data,t)}}class GroupingNode{constructor(t){this.type="Grouping",this.data=t}toArray(){return s(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return i(this.data,t)}}class ConditionNode{constructor(t,r,e){this.type="Condition",this.data=e,this.dataTrue=r,this.dataFalse=t}toArray(){return r("(",s(this.data),"?",s(this.dataTrue),":",s(this.dataFalse),")")}toString(){return`(${this.data||NaN} ? ${this.dataTrue||NaN} : ${this.dataFalse||NaN})`}calculate(t){return i(this.data,t)?i(this.dataTrue,t):i(this.dataFalse,t)}}class ArgumentNode{constructor(t){this.type="Argument",this.data=t}toArray(){return[this.data]}toString(){return""+this.data}calculate(t){var r=this.data,e=+r;if(e!=e&&"NaN"!==r&&t)for(var a,s=t.length;s-- >0;)if(n(a=t[s],r))return a[r];return e}}function o(t,e){return 0===e?t.toArray():r(",",t.toArray())}function u(t){return t.calculate(this)}class FunctionNode{constructor(t,r){this.type="Function",this.data=t,this.dataArgs=r}toArray(){return r(this.data+"(",t.apply([],this.dataArgs.map(o)),")")}toString(){return`${this.data}(${this.dataArgs.join(", ")})`}calculate(t){var r=this.data;if(t)for(var e,s=t.length;s-- >0;)if(n(e=t[s],r)&&a(e=e[r]))return e.apply(void 0,this.dataArgs.map(u,t));return NaN}}class OperationNode{constructor(t,r,e){this.type="Operation",this.data=t,this.dataLeft=e,this.dataRight=r}toArray(){var t=this.data,e=this.dataLeft,a=this.dataRight,n=s(e),i=s(a);return a?e?"!"===t||"~"===t?["NaN"]:r("(",n,t,i,")"):"!"===t||"~"===t||"-"===t?r(t,i):i:n}toString(){var t=this.data,r=this.dataLeft,e=this.dataRight,a=""+(r||NaN),n=""+(e||NaN);return e?r?"!"===t||"~"===t?"NaN":`(${a} ${t} ${n})`:"!"===t||"~"===t||"-"===t?t+n:n:a}calculate(t){var r,e=this.data,s=this.dataLeft,o=this.dataRight,u=i(s,t),c=i(o,t);if(!o)return u;if(t)for(var h,d=t.length;d-- >0;)if(n(h=t[d],e)&&a(h=h[e])){r=h;break}if(!s){switch(e){case"!":return r?r(c):+!+c;case"~":return r?r(c):~+c;case"+":return r?r(0,c):+c;case"-":return r?r(0,c):-+c}return c}if(r)return r(u,c);switch(u=+u,c=+c,e){case"**":return Math.pow(u,c);case"*":return u*c;case"/":return u/c;case"%":return u%c;case"+":return u+c;case"-":return u-c;case"<<":return u<<c;case">>":return u>>c;case">>>":return u>>>c;case"<":return u<c?1:0;case"<=":return u<=c?1:0;case">":return u>c?1:0;case">=":return u>=c?1:0;case"=":case"==":return u==c?1:0;case"===":return u===c?1:0;case"!=":return u!=c?1:0;case"!==":return u!==c?1:0;case"&":return u&c;case"^":return u^c;case"|":return u|c;case"&&":return u?c:u;case"||":return u||c;case"??":return u==u?u:c}return NaN}}var c=/\?\??|\|\|?|\*\*?|&&?|<<|>>>?|[!=]=?=?|[<>]=?|(?<!\d\.?[eE])[-+]|[,:~^%/()[\]]/g,h={"!":14,"~":14,"**":13,"*":12,"/":12,"%":12,"+":11,"-":11,"<<":10,">>":10,">>>":10,"<":9,"<=":9,">":9,">=":9,"=":8,"==":8,"!=":8,"===":8,"!==":8,"&":7,"^":6,"|":5,"&&":4,"||":3,"??":3,"?":2,":":2,",":1};function d(t,a,n,s,i,o,u){if(o[a]&&o[a].length)for(var c,h=o[a],l=h.length;l-- >0;)if((c=h[l]-n)>-1&&c<t.length)return h.splice(l,1),r(d(t.slice(0,c),a,n,s,i,o,u),d(t.slice(c+1),a,n+c+1,s,i,o,u));if(i[a]&&i[a].length)for(var p,f,N=i[a],g=N.length;g-- >0;)if(p=N[g].f-n,f=N[g].s-n,p>-1&&p<t.length&&f>p)return N.splice(g,1),new ConditionNode(e(r(d(t.slice(f+1),a,n+f+1,s,i,o,u))),e(r(d(t.slice(p+1,f),a,n+p+1,s,i,o,u))),e(r(d(t.slice(0,p),a,n,s,i,o,u))));if(u[a]&&u[a].length)for(var y,v=u[a],A=v.length;A-- >0;)if((y=v[A]-n)>-1&&y<t.length)return v.splice(A,1),new OperationNode(t[y],e(r(d(t.slice(y+1),a,n+y+1,s,i,o,u))),e(r(d(t.slice(0,y),a,n,s,i,o,u))));if(s[a]&&s[a].length)for(var m,w,x=s[a],b=x.length;b-- >0;)if(m=x[b].f-n,w=x[b].s-n,m>-1&&m<t.length&&w>m)return x.splice(b,1),"("===t[m]?new GroupingNode(e(r(d(t.slice(m+1,w),a+1,n+m+1,s,i,o,u)))):new FunctionNode(t[m],r(d(t.slice(m+2,w),a+1,n+m+2,s,i,o,u)));var k=t.join("");return k?new ArgumentNode(k):[]}function l(t,r,e,a){t[r]||(t[r]=[]),t[r][e]||(t[r][e]=[]),t[r][e][e===h["**"]?"unshift":"push"](a.length)}function p(t,r,e){l(t,r,h["*"],e),e.push("*")}exports.ArgumentNode=ArgumentNode,exports.ConditionNode=ConditionNode,exports.FunctionNode=FunctionNode,exports.GroupingNode=GroupingNode,exports.OperationNode=OperationNode,exports.ProgramNode=ProgramNode,exports.create=function(t){t="("+t+")";var a,n,s,i,o,u=[],f=0,N="",g=0,y=0,v={},A={},m={},w={},x=h["!"],b={},k={},F={};for(c.lastIndex=0;o=c.exec(t);)switch(a=o[0]){case"[":y++;break;case"]":y--;break;default:if(0!==y)break;switch(o.index>f&&(n=t.slice(f,o.index).trim())&&(")"===N&&p(F,g,u),u.push(N=n)),a){case"(":A[g]||(A[g]=[]),A[g].push({f:u.length,s:-1}),!N||"("===N||h[N]>0||(t[o.index-1].trim()&&"NaN"!==N&&""+ +N=="NaN"?(s=A[g]&&e(A[g]))&&s.f--:(p(F,g,u),(s=A[g]&&e(A[g]))&&s.f++)),g++;break;case")":(s=A[--g]&&e(A[g]))&&(s.s=u.length,(v[g]||(v[g]=[])).push(A[g].pop()));break;default:switch(")"!==N||h[a]>0||(p(F,g,u),N="*"),a){case",":b[g]||(b[g]=[]),b[g].push(u.length);break;case"?":w[g]||(w[g]=[]),w[g].push({f:u.length,s:-1});break;case":":(s=w[g]&&e(w[g]))&&(s.s=u.length,(m[g]||(m[g]=[])).push(w[g].pop()));break;default:if("("===N||h[N]>0){if("-"!==a&&"!"!==a&&"~"!==a){f=o.index+a.length;continue}i=++x}else i=h[a];l(F,g,i,u)}}f=o.index+a.length,u.push(N=a)}var O=Array.prototype.push;for(var $ in F){k[$]=[];for(var P=F[$],S=P.length;S-- >0;)P[S]&&O.apply(k[$],P[S])}return new ProgramNode(e(r(d(u.slice(1,-1),1,1,v,m,b,k))))};
