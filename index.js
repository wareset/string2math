/* eslint-disable */
Object.defineProperty(exports,"__esModule",{value:!0});var t=Array.prototype;function e(){return t.concat.apply([],arguments)}function n(t){return t[t.length-1]}var r=Math.pow,i=/^(NaN)?([-]?)(Infinity)?(\d*)\.?(\d*)[eE]?([-+]?\d*)$/,s=/^0+/;function o(t){var e=(+t+"").match(i);return{isNaN:!!e[1],isMinus:"-"===e[2],isInfinity:!!e[3],integer:(e[4]+e[5]).replace(s,""),exponent:+e[6]-e[5].length}}function a(t){return t.isNaN?NaN:t.isInfinity?t.isMinus?-1/0:1/0:+((t.isMinus?"-":"")+(t.integer||"0")+"e"+t.exponent)}function u(t,e){if(t=+t,0===(e=+e))return 1;if(e!=e||t!=t)return NaN;if(e===1/0)return e;if(0===t||e===-1/0)return 0;if(t===1/0||t===-1/0)return t;e<0&&(t=h(1,t),e=-e);for(var n=1,i=0;++i<=e;)n=c(n,t);return(e=p(e,1-i))>0&&(n=c(n,r(t,e))),n}function c(t,e){var n=o(t),r=o(e),i=n.exponent,s=r.exponent,u=(i>s?s-i:i-s)||i;n.exponent-=u,r.exponent-=u;var c=o(a(n)*a(r));return c.exponent+=u+u,a(c)}function h(t,e){var n=o(t),r=o(e),i=n.exponent,s=r.exponent,u=(i>s?s-i:i-s)||i;return n.exponent-=u,r.exponent-=u,a(n)/a(r)}function f(t,e){var n=o(t),r=o(e),i=n.exponent,s=r.exponent,u=(i>s?s-i:i-s)||i;n.exponent-=u,r.exponent-=u;var c=o(a(n)%a(r));return c.exponent+=u,a(c)}function p(t,e){var n=o(t),r=o(e),i=n.exponent,s=r.exponent,u=(i>s?s-i:i-s)||i;n.exponent-=u,r.exponent-=u;var c=o(a(n)+a(r));return c.exponent+=u,a(c)}var l=/\?\??|\|\|?|\*\*?|&&?|<<|>>>?|[!=]=?=?|[<>]=?|(?<!\d\.?[eE])[-+]|[,:~^%/()[\]]/g,N=function(){function ProgramNode(t){this.type="Program",this.is=t}var t=ProgramNode.prototype;return t.toArray=function(){return this.is?this.is.toArray():["NaN"]},t.toString=function(){return""+(this.is||NaN)},t.calculate=function(){return this.is?this.is.calculate(arguments):NaN},ProgramNode}(),d=function(){function ParenthesisNode(t){this.type="Parenthesis",this.is=t}var t=ParenthesisNode.prototype;return t.toArray=function(){return e("(",this.is?this.is.toArray():"NaN",")")},t.toString=function(){return"("+(this.is||NaN)+")"},t.calculate=function(){return this.is?this.is.calculate(arguments):NaN},ParenthesisNode}(),g=function(){function ConditionalNode(t,e,n){this.type="Conditional",this.is=n,this.isTrue=e,this.isFalse=t}var t=ConditionalNode.prototype;return t.toArray=function(){return e(this.is?this.is.toArray():"NaN","?",this.isTrue?this.isTrue.toArray():"NaN",":",this.isFalse?this.isFalse.toArray():"NaN")},t.toString=function(){return"("+(this.is||NaN)+" ? "+(this.isTrue||NaN)+" : "+(this.isFalse||NaN)+")"},t.calculate=function(){var t=this.is,e=(this.isTrue,this.isFalse),n=arguments;return t?t.calculate(n):e?e.calculate(n):NaN},ConditionalNode}(),x=function(){function ConstantNode(t){this.type="Constant",this.is=t}var t=ConstantNode.prototype;return t.toArray=function(){return[this.is]},t.toString=function(){return this.is},t.calculate=function(){for(var t=this.is,e=arguments,n=e.length;n-- >0;)if(t in e[n]&&"function"!=typeof e[n])return+e[n][t];return+t},ConstantNode}();function y(t,n){return 0===n?t.toArray():e(",",t.toArray())}function v(t){return t.calculate.apply(void 0,this)}var A=function(){function FunctionNode(t,e){this.type="Function",this.is=t,this.isArgs=e}var t=FunctionNode.prototype;return t.toArray=function(){return e(this.is+"(",e.apply(void 0,this.isArgs.map(y)),")")},t.toString=function(){return this.is+"("+this.isArgs.join(", ")+")"},t.calculate=function(){for(var t=this.is,e=arguments,n=e.length;n-- >0;)if(t in e[n]&&"function"==typeof e[n][t])return+e[n][t].apply(void 0,this.isArgs.map(v,e));return NaN},FunctionNode}(),w=function(){function OperatorNode(t,e,n){this.type="Operator",this.is=t,this.isLeft=n,this.isRight=e}var t=OperatorNode.prototype;return t.toArray=function(){var t=this.is,n=this.isLeft,r=this.isRight,i=n?n.toArray():["NaN"],s=r?r.toArray():["NaN"];return r?n?"!"===t||"~"===t?["NaN"]:e(i,t,s):!r||"-"!==t&&"!"!==t&&"~"!==t?s:e(t,s):n&&"%"===t?e(i,t):i},t.toString=function(){var t=this.is,e=this.isLeft,n=this.isRight,r=""+(e||NaN),i=""+(n||NaN);return n?e?"!"===t||"~"===t?"NaN":"("+r+" "+t+" "+i+")":!n||"-"!==t&&"!"!==t&&"~"!==t?i:t+i:e&&"%"===t?r+t:r},t.calculate=function(){var t=this.is,e=this.isLeft,n=this.isRight,r=arguments,i=e?e.calculate(r):NaN,s=n?n.calculate(r):NaN;if(!n)return e&&"%"===t?h(i,100):i;if(!e){if(n){if("-"===t)return-s;if("!"===t)return+!s;if("~"===t)return~s}return s}for(var o=r.length;o-- >0;)if(t in r[o]&&"function"==typeof r[o][t])return+r[o][t](i,s);switch(t){case"**":return u(i,s);case"*":return c(i,s);case"/":return h(i,s);case"%":return f(i,s);case"+":return p(i,s);case"-":return p(i,-s);case"<<":return i<<s;case">>":return i>>s;case">>>":return i>>>s;case"<":return i<s?1:0;case"<=":return i<=s?1:0;case">":return i>s?1:0;case">=":return i>=s?1:0;case"=":case"==":case"===":return i===s?1:0;case"!=":case"!==":return i!==s?1:0;case"&":return i&s;case"^":return i^s;case"|":return i|s;case"&&":return i?s:i;case"||":return i||s;case"??":return i==i?i:s}return NaN},OperatorNode}(),m={"!":14,"~":14,"**":13,"*":12,"/":12,"%":12,"+":11,"-":11,"<<":10,">>":10,">>>":10,"<":9,"<=":9,">":9,">=":9,"=":8,"==":8,"!=":8,"===":8,"!==":8,"&":7,"^":6,"|":5,"&&":4,"||":3,"??":3,"?":2,":":2,",":1};function P(t,r,i,s,o,a,u){if(a[r]&&a[r].length)for(var c,h=a[r],f=h.length;f-- >0;)if((c=h[f]-i)>-1&&c<t.length)return h.splice(f,1),e(P(t.slice(0,c),r,i,s,o,a,u),P(t.slice(c+1),r,i+c+1,s,o,a,u));if(o[r]&&o[r].length)for(var p,l,N=o[r],y=N.length;y-- >0;)if(p=N[y].f-i,l=N[y].s-i,p>-1&&p<t.length&&l>p)return N.splice(y,1),new g(n(e(P(t.slice(l+1),r,i+l+1,s,o,a,u))),n(e(P(t.slice(p+1,l),r,i+p+1,s,o,a,u))),n(e(P(t.slice(0,p),r,i,s,o,a,u))));if(u[r]&&u[r].length)for(var v,b=u[r],C=b.length;C-- >0;)if((v=b[C]-i)>-1&&v<t.length){if(C>0&&"%"!==t[v-1]&&(m[t[v-1]]||"%"===t[v]&&(!t[v+1]||m[t[v+1]]<m["~"])))continue;return b.splice(C,1),new w(t[v],n(e(P(t.slice(v+1),r,i+v+1,s,o,a,u))),n(e(P(t.slice(0,v),r,i,s,o,a,u))))}if(s[r]&&s[r].length)for(var F,k,O=s[r],S=O.length;S-- >0;)if(F=O[S].f-i,k=O[S].s-i,F>-1&&F<t.length&&k>F)return O.splice(S,1),"("===t[F]?new d(n(e(P(t.slice(F+1,k),r+1,i+F+1,s,o,a,u)))):new A(t[F],e(P(t.slice(F+2,k),r+1,i+F+2,s,o,a,u)));var M=t.join("");return M?new x(M):[]}function b(t,e,n,r){t[e]||(t[e]=[]),t[e][n]||(t[e][n]=[]),t[e][n][n===m["**"]?"unshift":"push"](r.length)}function C(t,e,n){b(t,e,m["*"],n),n.push("*")}function F(r){r="("+r+")",l.lastIndex=0;for(var i,s,o,a,u=[],c=0,h="",f=0,p=0,d={},g={},x={},y={},v={},A={},w={};a=l.exec(r);)switch(i=a[0]){case"[":p++;break;case"]":p--;break;default:if(0!==p)break;switch(a.index>c&&(s=r.slice(c,a.index).trim())&&(")"===h&&C(w,f,u),u.push(h=s)),i){case"(":g[f]||(g[f]=[]),g[f].push({f:u.length,s:-1}),h&&(/^[a-z][$\w]*$/.test(h)?(o=g[f]&&n(g[f]))&&o.f--:"("===h||m[h]||(C(w,f,u),(o=g[f]&&n(g[f]))&&o.f++)),f++;break;case")":(o=g[--f]&&n(g[f]))&&(o.s=u.length,(d[f]||(d[f]=[])).push(g[f].pop()));break;default:switch(")"!==h||m[i]||(C(w,f,u),h="*"),i){case",":v[f]||(v[f]=[]),v[f].push(u.length);break;case"?":y[f]||(y[f]=[]),y[f].push({f:u.length,s:-1});break;case":":(o=y[f]&&n(y[f]))&&(o.s=u.length,(x[f]||(x[f]=[])).push(y[f].pop()));break;default:b(w,f,m[i],u)}}u.push(h=i),c=a.index+i.length}for(var F in w){A[F]=[];for(var k=w[F],O=k.length;O-- >0;)k[O]&&t.push.apply(A[F],k[O])}return new N(n(e(P(u.slice(1,-1),1,1,d,x,v,A))))}exports.ConditionalNode=g,exports.ConstantNode=x,exports.FunctionNode=A,exports.OperatorNode=w,exports.ParenthesisNode=d,exports.ProgramNode=N,exports.add=p,exports.create=F,exports.default=F,exports.div=h,exports.exp=u,exports.mul=c,exports.num2raw=o,exports.raw2num=a,exports.rem=f,exports.sub=function(t,e){return p(t,-e)};
