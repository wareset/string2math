/* eslint-disable */
var t=Array.prototype.concat;function r(){return t.apply([],arguments)}function e(t){return t[t.length-1]}var a=Array.prototype.push;function n(t){return"function"==typeof t}var s=Object.prototype.hasOwnProperty,i=Object.hasOwn||function(t,r){return s.call(t,r)};function o(t){return t?t.toArray():["NaN"]}function u(t,r){return t?t.calculate(r):NaN}class ProgramNode{constructor(t){this.type="Program",this.data=t}toArray(){return o(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return u(this.data,t)}}class GroupingNode{constructor(t){this.type="Grouping",this.data=t}toArray(){return o(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return u(this.data,t)}}class ConditionNode{constructor(t,r,e){this.type="Condition",this.data=e,this.dataTrue=r,this.dataFalse=t}toArray(){return r("(",o(this.data),"?",o(this.dataTrue),":",o(this.dataFalse),")")}toString(){return`(${this.data||NaN} ? ${this.dataTrue||NaN} : ${this.dataFalse||NaN})`}calculate(t){return u(this.data,t)?u(this.dataTrue,t):u(this.dataFalse,t)}}class ArgumentNode{constructor(t){this.type="Argument",this.data=t}toArray(){return[this.data]}toString(){return""+this.data}calculate(t){var r=this.data,e=+r;if(e!=e&&"NaN"!==r&&t)for(var a,n=t.length;n-- >0;)if(i(a=t[n],r))return a[r];return e}}function c(t,e){return 0===e?t.toArray():r(",",t.toArray())}function h(t){return t.calculate(this)}class FunctionNode{constructor(t,r){this.type="Function",this.data=t,this.dataArgs=r}toArray(){return r(this.data+"(",t.apply([],this.dataArgs.map(c)),")")}toString(){return`${this.data}(${this.dataArgs.join(", ")})`}calculate(t){var r=this.data;if(t)for(var e,a=t.length;a-- >0;)if(i(e=t[a],r)&&n(e=e[r]))return e.apply(void 0,this.dataArgs.map(h,t));return NaN}}class OperationNode{constructor(t,r,e){this.type="Operation",this.data=t,this.dataLeft=e,this.dataRight=r}toArray(){var t=this.data,e=this.dataLeft,a=this.dataRight,n=o(e),s=o(a);return a?e?"!"===t||"~"===t?["NaN"]:r("(",n,t,s,")"):"!"===t||"~"===t||"-"===t?r(t,s):s:n}toString(){var t=this.data,r=this.dataLeft,e=this.dataRight,a=""+(r||NaN),n=""+(e||NaN);return e?r?"!"===t||"~"===t?"NaN":`(${a} ${t} ${n})`:"!"===t||"~"===t||"-"===t?t+n:n:a}calculate(t){var r,e=this.data,a=this.dataLeft,s=this.dataRight,o=u(a,t),c=u(s,t);if(!s)return o;if(t)for(var h,d=t.length;d-- >0;)if(i(h=t[d],e)&&n(h=h[e])){r=h;break}if(!a){switch(e){case"!":return r?r(c):+!+c;case"~":return r?r(c):~+c;case"+":return r?r(0,c):+c;case"-":return r?r(0,c):-+c}return c}if(r)return r(o,c);switch(o=+o,c=+c,e){case"**":return Math.pow(o,c);case"*":return o*c;case"/":return o/c;case"%":return o%c;case"+":return o+c;case"-":return o-c;case"<<":return o<<c;case">>":return o>>c;case">>>":return o>>>c;case"<":return o<c?1:0;case"<=":return o<=c?1:0;case">":return o>c?1:0;case">=":return o>=c?1:0;case"=":case"==":return o==c?1:0;case"===":return o===c?1:0;case"!=":return o!=c?1:0;case"!==":return o!==c?1:0;case"&":return o&c;case"^":return o^c;case"|":return o|c;case"&&":return o?c:o;case"||":return o||c;case"??":return o==o?o:c}return NaN}}var d=/\?\??|\|\|?|\*\*?|&&?|<<|>>>?|[!=]=?=?|[<>]=?|(?<!\d\.?[eE])[-+]|[,:~^%/()[\]]/g,l={"!":14,"~":14,"**":13,"*":12,"/":12,"%":12,"+":11,"-":11,"<<":10,">>":10,">>>":10,"<":9,"<=":9,">":9,">=":9,"=":8,"==":8,"!=":8,"===":8,"!==":8,"&":7,"^":6,"|":5,"&&":4,"||":3,"??":3,"?":2,":":2,",":1};function p(t,a,n,s,i,o,u){if(o[a]&&o[a].length)for(var c,h=o[a],d=h.length;d-- >0;)if((c=h[d]-n)>-1&&c<t.length)return h.splice(d,1),r(p(t.slice(0,c),a,n,s,i,o,u),p(t.slice(c+1),a,n+c+1,s,i,o,u));if(i[a]&&i[a].length)for(var l,f,N=i[a],g=N.length;g-- >0;)if(l=N[g].f-n,f=N[g].s-n,l>-1&&l<t.length&&f>l)return N.splice(g,1),new ConditionNode(e(r(p(t.slice(f+1),a,n+f+1,s,i,o,u))),e(r(p(t.slice(l+1,f),a,n+l+1,s,i,o,u))),e(r(p(t.slice(0,l),a,n,s,i,o,u))));if(u[a]&&u[a].length)for(var y,v=u[a],A=v.length;A-- >0;)if((y=v[A]-n)>-1&&y<t.length)return v.splice(A,1),new OperationNode(t[y],e(r(p(t.slice(y+1),a,n+y+1,s,i,o,u))),e(r(p(t.slice(0,y),a,n,s,i,o,u))));if(s[a]&&s[a].length)for(var m,w,x=s[a],b=x.length;b-- >0;)if(m=x[b].f-n,w=x[b].s-n,m>-1&&m<t.length&&w>m)return x.splice(b,1),"("===t[m]?new GroupingNode(e(r(p(t.slice(m+1,w),a+1,n+m+1,s,i,o,u)))):new FunctionNode(t[m],r(p(t.slice(m+2,w),a+1,n+m+2,s,i,o,u)));var k=t.join("");return k?new ArgumentNode(k):[]}function f(t,r,e,a){t[r]||(t[r]=[]),t[r][e]||(t[r][e]=[]),t[r][e][e===l["**"]?"unshift":"push"](a.length)}function N(t,r,e){f(t,r,l["*"],e),e.push("*")}exports.ArgumentNode=ArgumentNode,exports.ConditionNode=ConditionNode,exports.FunctionNode=FunctionNode,exports.GroupingNode=GroupingNode,exports.OperationNode=OperationNode,exports.ProgramNode=ProgramNode,exports.create=function(t){t="("+t+")";var n,s,i,o,u,c=[],h=0,g="",y=0,v=0,A={},m={},w={},x={},b=l["!"],k={},F={},O={};for(d.lastIndex=0;u=d.exec(t);)switch(n=u[0]){case"[":v++;break;case"]":v--;break;default:if(0!==v)break;switch(u.index>h&&(s=t.slice(h,u.index).trim())&&(")"===g&&N(O,y,c),c.push(g=s)),n){case"(":m[y]||(m[y]=[]),m[y].push({f:c.length,s:-1}),!g||"("===g||l[g]>0||(t[u.index-1].trim()&&"NaN"!==g&&""+ +g=="NaN"?(i=m[y]&&e(m[y]))&&i.f--:(N(O,y,c),(i=m[y]&&e(m[y]))&&i.f++)),y++;break;case")":(i=m[--y]&&e(m[y]))&&(i.s=c.length,(A[y]||(A[y]=[])).push(m[y].pop()));break;default:switch(")"!==g||l[n]>0||(N(O,y,c),g="*"),n){case",":k[y]||(k[y]=[]),k[y].push(c.length);break;case"?":x[y]||(x[y]=[]),x[y].push({f:c.length,s:-1});break;case":":(i=x[y]&&e(x[y]))&&(i.s=c.length,(w[y]||(w[y]=[])).push(x[y].pop()));break;default:if("("===g||l[g]>0){if("-"!==n&&"!"!==n&&"~"!==n){h=u.index+n.length;continue}o=++b}else o=l[n];f(O,y,o,c)}}h=u.index+n.length,c.push(g=n)}for(var $ in O){F[$]=[];for(var P=O[$],S=P.length;S-- >0;)P[S]&&a.apply(F[$],P[S])}return new ProgramNode(e(r(p(c.slice(1,-1),1,1,A,w,k,F))))};
