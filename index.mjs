/* eslint-disable */
var t=Array.prototype.concat;function r(){return t.apply([],arguments)}function e(t){return t[t.length-1]}function a(t){return"function"==typeof t}var n=Object.hasOwn||function(t,r){return Object.prototype.hasOwnProperty.call(t,r)};function s(t){return t?t.toArray():["NaN"]}function i(t,r){return t?t.calculate(r):NaN}class ProgramNode{constructor(t){this.type="Program",this.data=t}toArray(){return s(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return i(this.data,t)}}class GroupingNode{constructor(t){this.type="Grouping",this.data=t}toArray(){return s(this.data)}toString(){return""+(this.data||NaN)}calculate(t){return i(this.data,t)}}class ConditionNode{constructor(t,r,e){this.type="Condition",this.data=e,this.dataTrue=r,this.dataFalse=t}toArray(){return r("(",s(this.data),"?",s(this.dataTrue),":",s(this.dataFalse),")")}toString(){return`(${this.data||NaN} ? ${this.dataTrue||NaN} : ${this.dataFalse||NaN})`}calculate(t){return i(this.data,t)?i(this.dataTrue,t):i(this.dataFalse,t)}}class ArgumentNode{constructor(t){this.type="Argument",this.data=t}toArray(){return[this.data]}toString(){return""+this.data}calculate(t){var r=this.data,e=+r;if(e!=e&&"NaN"!==r&&t)for(var a,s=t.length;s-- >0;)if(n(a=t[s],r))return a[r];return e}}function u(t,e){return 0===e?t.toArray():r(",",t.toArray())}function c(t){return t.calculate(this)}class FunctionNode{constructor(t,r){this.type="Function",this.data=t,this.dataArgs=r}toArray(){return r(this.data+"(",t.apply([],this.dataArgs.map(u)),")")}toString(){return`${this.data}(${this.dataArgs.join(", ")})`}calculate(t){var r=this.data;if(t)for(var e,s=t.length;s-- >0;)if(n(e=t[s],r)&&a(e=e[r]))return e.apply(void 0,this.dataArgs.map(c,t));return NaN}}class OperationNode{constructor(t,r,e){this.type="Operation",this.data=t,this.dataLeft=e,this.dataRight=r}toArray(){var t=this.data,e=this.dataLeft,a=this.dataRight,n=s(e),i=s(a);return a?e?"!"===t||"~"===t?["NaN"]:r("(",n,t,i,")"):"!"===t||"~"===t||"-"===t?r(t,i):i:n}toString(){var t=this.data,r=this.dataLeft,e=this.dataRight,a=""+(r||NaN),n=""+(e||NaN);return e?r?"!"===t||"~"===t?"NaN":`(${a} ${t} ${n})`:"!"===t||"~"===t||"-"===t?t+n:n:a}calculate(t){var r,e=this.data,s=this.dataLeft,u=this.dataRight,c=i(s,t),o=i(u,t);if(!u)return c;if(t)for(var h,d=t.length;d-- >0;)if(n(h=t[d],e)&&a(h=h[e])){r=h;break}if(!s){switch(e){case"!":return r?r(o):+!+o;case"~":return r?r(o):~+o;case"+":return r?r(0,o):+o;case"-":return r?r(0,o):-+o}return o}if(r)return r(c,o);switch(c=+c,o=+o,e){case"**":return Math.pow(c,o);case"*":return c*o;case"/":return c/o;case"%":return c%o;case"+":return c+o;case"-":return c-o;case"<<":return c<<o;case">>":return c>>o;case">>>":return c>>>o;case"<":return c<o?1:0;case"<=":return c<=o?1:0;case">":return c>o?1:0;case">=":return c>=o?1:0;case"=":case"==":return c==o?1:0;case"===":return c===o?1:0;case"!=":return c!=o?1:0;case"!==":return c!==o?1:0;case"&":return c&o;case"^":return c^o;case"|":return c|o;case"&&":return c?o:c;case"||":return c||o;case"??":return c==c?c:o}return NaN}}var o=/\?\??|\|\|?|\*\*?|&&?|<<|>>>?|[!=]=?=?|[<>]=?|(?<!\d\.?[eE])[-+]|[,:~^%/()[\]]/g,h={"!":14,"~":14,"**":13,"*":12,"/":12,"%":12,"+":11,"-":11,"<<":10,">>":10,">>>":10,"<":9,"<=":9,">":9,">=":9,"=":8,"==":8,"!=":8,"===":8,"!==":8,"&":7,"^":6,"|":5,"&&":4,"||":3,"??":3,"?":2,":":2,",":1};function d(t,a,n,s,i,u,c){if(u[a]&&u[a].length)for(var o,h=u[a],l=h.length;l-- >0;)if((o=h[l]-n)>-1&&o<t.length)return h.splice(l,1),r(d(t.slice(0,o),a,n,s,i,u,c),d(t.slice(o+1),a,n+o+1,s,i,u,c));if(i[a]&&i[a].length)for(var f,g,p=i[a],N=p.length;N-- >0;)if(f=p[N].f-n,g=p[N].s-n,f>-1&&f<t.length&&g>f)return p.splice(N,1),new ConditionNode(e(r(d(t.slice(g+1),a,n+g+1,s,i,u,c))),e(r(d(t.slice(f+1,g),a,n+f+1,s,i,u,c))),e(r(d(t.slice(0,f),a,n,s,i,u,c))));if(c[a]&&c[a].length)for(var y,v=c[a],A=v.length;A-- >0;)if((y=v[A]-n)>-1&&y<t.length)return v.splice(A,1),new OperationNode(t[y],e(r(d(t.slice(y+1),a,n+y+1,s,i,u,c))),e(r(d(t.slice(0,y),a,n,s,i,u,c))));if(s[a]&&s[a].length)for(var w,m,b=s[a],k=b.length;k-- >0;)if(w=b[k].f-n,m=b[k].s-n,w>-1&&w<t.length&&m>w)return b.splice(k,1),"("===t[w]?new GroupingNode(e(r(d(t.slice(w+1,m),a+1,n+w+1,s,i,u,c)))):new FunctionNode(t[w],r(d(t.slice(w+2,m),a+1,n+w+2,s,i,u,c)));var x=t.join("");return x?new ArgumentNode(x):[]}function l(t,r,e,a){t[r]||(t[r]=[]),t[r][e]||(t[r][e]=[]),t[r][e][e===h["**"]?"unshift":"push"](a.length)}function f(t,r,e){l(t,r,h["*"],e),e.push("*")}function g(t){t="("+t+")";var a,n,s,i,u,c=[],g=0,p="",N=0,y=0,v={},A={},w={},m={},b=h["!"],k={},x={},F={};for(o.lastIndex=0;u=o.exec(t);)switch(a=u[0]){case"[":y++;break;case"]":y--;break;default:if(0!==y)break;switch(u.index>g&&(n=t.slice(g,u.index).trim())&&(")"===p&&f(F,N,c),c.push(p=n)),a){case"(":A[N]||(A[N]=[]),A[N].push({f:c.length,s:-1}),!p||"("===p||h[p]>0||(t[u.index-1].trim()&&"NaN"!==p&&""+ +p=="NaN"?(s=A[N]&&e(A[N]))&&s.f--:(f(F,N,c),(s=A[N]&&e(A[N]))&&s.f++)),N++;break;case")":(s=A[--N]&&e(A[N]))&&(s.s=c.length,(v[N]||(v[N]=[])).push(A[N].pop()));break;default:switch(")"!==p||h[a]>0||(f(F,N,c),p="*"),a){case",":k[N]||(k[N]=[]),k[N].push(c.length);break;case"?":m[N]||(m[N]=[]),m[N].push({f:c.length,s:-1});break;case":":(s=m[N]&&e(m[N]))&&(s.s=c.length,(w[N]||(w[N]=[])).push(m[N].pop()));break;default:if("("===p||h[p]>0){if("-"!==a&&"!"!==a&&"~"!==a){g=u.index+a.length;continue}i=++b}else i=h[a];l(F,N,i,c)}}g=u.index+a.length,c.push(p=a)}var O=Array.prototype.push;for(var $ in F){x[$]=[];for(var S=F[$],P=S.length;P-- >0;)S[P]&&O.apply(x[$],S[P])}return new ProgramNode(e(r(d(c.slice(1,-1),1,1,v,w,k,x))))}export{ArgumentNode,ConditionNode,FunctionNode,GroupingNode,OperationNode,ProgramNode,g as create};
